<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags google -->
    <title>Simpson Phrases - Buscador de Frases de Los Simpson</title>
    <meta name="description" content="El mejor buscador de frases de Los Simpson en español. Encuentra clips, videos cortos y momentos memorables de la serie. Frases célebres de Homero, Bart, Lisa y todos los personajes. Buscador inteligente con videos.">
    
    <!-- Keywords más específicas -->
    <meta name="keywords" content="Los Simpson, frases simpson español, frases homero simpson, videos simpson español, clips simpson latino, momentos simpson, frases bart simpson, mejores frases simpson, buscador frases simpson, simpson quotes español, videos cortos simpson, momentos graciosos simpson, escenas simpson, simpson latino">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://simpsonphrases.com/">
    <meta property="og:title" content="Simpson Phrases - Buscador de Frases de Los Simpson">
    <meta property="og:description" content="Encuentra las mejores frases y videos cortos de Los Simpson. Momentos memorables de la serie.">
    <meta property="og:image" content="https://simpsonphrases.com/static/SimpsonLogo7.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://simpsonphrases.com/">
    <meta property="twitter:title" content="Simpson Phrases - Buscador de Frases de Los Simpson">
    <meta property="twitter:description" content="Encuentra las mejores frases y videos cortos de Los Simpson. Momentos memorables de la serie.">
    <meta property="twitter:image" content="https://simpsonphrases.com/static/SimpsonLogo7.png">

    <!-- Metadatos adicionales -->
    <meta name="author" content="Simpson Phrases">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Spanish">
    <link rel="canonical" href="https://simpsonphrases.com/">

    <!-- Resto de tus estilos y configuraciones actuales -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Akbar';
            src: url('/static/akbar.ttf') format('truetype');
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Akbar', sans-serif;
            background-size: cover;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            background-color: rgb(6 6 6 / 100%);
        }

        .header {
            background: rgb(6 6 6 / 84%);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.5);
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo-container img {
            height: auto;  /* Cambiamos a auto para mantener proporción */
            width: 300px;  /* Ancho fijo para el logo */
            margin-right: 15px;
        }

        .header h1 {
            font-size: 3.5rem;
            font-family: 'Akbar', sans-serif;
            color: #ffcc00;
            text-shadow: 3px 3px #000;
            margin: 0;
        }

        .header p {
            font-family: 'Akbar', sans-serif;
            font-size: 1.5rem;
            color: #ffffff;
            margin: 30px;
            text-align: right;
        }

        .search-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        input[type="text"] {
            font-family: 'Akbar', sans-serif;
            padding: 15px 20px;
            border-radius: 50px;
            border: none;
            outline: none;
            font-size: 1.2rem;
            width: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            color: black;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
        }

        input[type="text"]:focus {
            box-shadow: 0px 5px 20px rgba(255, 204, 0, 0.7);
        }

        .btn {
            font-family: 'Akbar', sans-serif;
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .btn-search {
            background-color: #ffcc00;
            color: black;
            transition: 0.3s ease;
        }

        .btn-search:hover {
            background-color: #ff9900;
            color: white;
            transform: rotate(-5deg);
        }

        .btn-random {
            background-color: #666;
            color: white;
            transition: 0.3s ease;
        }

        .btn-random:hover {
            background-color: #444;
            transform: rotate(5deg);
        }

        .result-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding: 20px;
            box-sizing: border-box;
            background: url('/static/Img4.jpg') no-repeat center center;
            background-size: cover;
            position: relative;
        }

        .result-overlay {
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        .result-text {
            width: 48%;
            line-height: 1.8;
        }

        .result-text h3 {
            font-family: 'Akbar', sans-serif;
            color: #ffcc00;
            margin-bottom: 15px;
        }

        .result-text p {
            font-family: 'Akbar', sans-serif;
        }

        .video-container {
            width: 48%;
        }

        .video-container iframe {
            width: 100%;
            height: 315px;
            border-radius: 10px;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 10px;
            }

            .header h1 {
                font-size: 2.5rem;
                margin-bottom: 10px;
            }

            .header p {
                font-size: 1.2rem;
                margin: 10px 0;
                text-align: center;
            }

            .search-bar {
                flex-direction: column;
                align-items: center;
                gap: 10px;
                padding: 0 20px;
            }

            input[type="text"] {
                width: 90%;
                font-size: 1rem;
            }

            .btn {
                width: 90%;
                margin: 5px 0;
            }

            .result-container {
                margin-top: 20px;
                padding: 10px;
            }

            .result-overlay {
                flex-direction: column;
                gap: 20px;
            }

            .result-text, 
            .video-container {
                width: 100%;
            }

            .video-container iframe {
                height: 200px;
            }

            .loading img {
                width: 120px;
            }

            .loading p {
                font-size: 1.5em;
            }

            .logo-container img {
                width: 200px;  /* Más pequeño en móviles */
            }
        }

        /* Para pantallas muy pequeñas */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: 1rem;
            }

            input[type="text"] {
                width: 95%;
            }

            .btn {
                width: 95%;
            }

            .result-text h3 {
                font-size: 1.2rem;
            }

            .video-container iframe {
                height: 180px;
            }

            .logo-container img {
                width: 150px;  /* Aún más pequeño en pantallas muy pequeñas */
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading img {
            width: 180px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading.active {
            display: block;
        }

        .loading p {
            font-family: 'Akbar', sans-serif;
            color: #ffcc00;
            font-size: 2em;
            margin-top: 15px;
            text-shadow: 2px 2px #000;
        }

        .error-message {
            text-align: center;
            padding: 20px;
        }

        .error-message img {
            max-width: 200px;
            margin: 10px 0;
            border-radius: 10px;
        }

        .error-message h3 {
            font-family: 'Akbar', sans-serif;
            color: #ffcc00;
            font-size: 1.8em;
            margin: 15px 0;
            text-shadow: 2px 2px #000;
        }

        .btn-meme {
            background-color: #ff4081;
            margin-top: 10px;
        }

        .meme-controls {
            text-align: center;
            margin-top: 10px;
        }

        .meme-preview {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .meme-modal {
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            max-height: 90vh;
            overflow: auto;
        }

        .meme-modal img {
            max-width: 100%;
            border-radius: 5px;
        }

        .meme-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .meme-actions .btn {
            padding: 10px 20px;
        }
    </style>

    <!-- Schema.org para Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Simpson Phrases",
      "description": "Buscador de frases y videos de Los Simpson",
      "url": "https://simpsonphrases.com/",
      "applicationCategory": "EntertainmentApplication",
      "operatingSystem": "All",
      "inLanguage": "es"
    }
    </script>
</head>
<body>

    <!-- Header -->
    <div class="header">
        <div class="logo-container">
            <img src="/static/SimpsonLogo7.png" alt="Simpson Phrases Logo">
        </div>
        <p>Encuentra tus frases favoritas de Los Simpsons</p>
    </div>

    <!-- Search Section -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Ingrese una frase de Los Simpsons">
        <button class="btn btn-search" id="searchButton">Buscar</button>
        <button class="btn btn-random" id="randomButton">Random</button>
    </div>

    <!-- Loading Section -->
    <div id="loading" class="loading">
        <img src="/static/donut3.png" alt="Cargando...">
        <p>¡D'oh! Buscando...</p>
    </div>

    <!-- Results Section -->
    <div id="results"></div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const randomButton = document.getElementById('randomButton');
        const resultsDiv = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');

        searchButton.addEventListener('click', searchPhrase);
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPhrase();
            }
        });

        randomButton.addEventListener('click', async function() {
            loadingDiv.classList.add('active');
            resultsDiv.innerHTML = '';

            try {
                const response = await fetch('/api/random');
                const data = await response.json();
                
                loadingDiv.classList.remove('active');
                displayResults(data);
                
            } catch (error) {
                console.error('Error:', error);
                loadingDiv.classList.remove('active');
                showError();
            }
        });

        async function searchPhrase() {
            const phrase = searchInput.value.trim();
            if (phrase.length < 3) {
                resultsDiv.innerHTML = '<p>Ingresa al menos 3 caracteres</p>';
                return;
            }

            loadingDiv.classList.add('active');
            resultsDiv.innerHTML = '';

            try {
                const response = await fetch(`/api/search?phrase=${encodeURIComponent(phrase)}`);
                const data = await response.json();
                
                loadingDiv.classList.remove('active');
                displayResults(data);

            } catch (error) {
                console.error('Error:', error);
                loadingDiv.classList.remove('active');
                showError();
            }
        }

        function displayResults(data) {
            if (Array.isArray(data) && data.length > 0) {
                data.forEach(episode => {
                    const resultHtml = `
                        <div class="result-container">
                            <div class="result-overlay">
                                <div class="result-text">
                                    <h3>${episode.phrase}</h3>
                                    <p><strong>Episodio:</strong> ${episode.episode}</p>
                                    <p><strong>Título:</strong> ${episode.title}</p>
                                </div>
                                <div class="video-container">
                                    <iframe 
                                        src="https://www.youtube.com/embed/${getYouTubeId(episode.youtube_url)}"
                                        frameborder="0"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        allowfullscreen>
                                    </iframe>
                                    <div class="meme-controls">
                                        <button class="btn btn-meme" onclick="createMeme(this)">
                                            Crear Meme
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    resultsDiv.innerHTML += resultHtml;
                });
            } else {
                showError();
            }
        }

        function showError() {
            resultsDiv.innerHTML = `
                <div class="result-container">
                    <div class="result-overlay">
                        <div class="error-message">
                            <img src="/static/homerotoalla.jpg" alt="Homero con toalla">
                            <h3>Busque mejor que tengo una toalla</h3>
                        </div>
                    </div>
                </div>`;
        }

        function getYouTubeId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        async function createMeme(button) {
            try {
                // Obtener el iframe del video
                const videoContainer = button.closest('.video-container');
                const iframe = videoContainer.querySelector('iframe');
                const videoId = iframe.src.split('/').pop();
                
                // Crear un canvas temporal
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Cargar la imagen del thumbnail de YouTube
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.src = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                
                await new Promise((resolve, reject) => {
                    img.onload = resolve;
                    img.onerror = reject;
                });
                
                // Configurar el canvas
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Dibujar la imagen
                ctx.drawImage(img, 0, 0);
                
                // Obtener el texto del usuario
                const text = prompt('Ingresa el texto para tu meme:');
                if (!text) return;
                
                // Configurar el estilo del texto
                ctx.font = '30px Akbar';
                ctx.fillStyle = 'white';
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 3;
                ctx.textAlign = 'center';
                
                // Agregar texto con sombra
                const x = canvas.width / 2;
                const y = canvas.height - 50;
                ctx.strokeText(text, x, y);
                ctx.fillText(text, x, y);
                
                // Convertir a imagen
                const memeUrl = canvas.toDataURL('image/jpeg', 0.8);
                
                // Crear elemento para mostrar el meme
                const memePreview = document.createElement('div');
                memePreview.className = 'meme-preview';
                memePreview.innerHTML = `
                    <div class="meme-modal">
                        <img src="${memeUrl}" alt="Meme">
                        <div class="meme-actions">
                            <button class="btn" onclick="downloadMeme('${memeUrl}')">Descargar</button>
                            <button class="btn" onclick="shareMeme('${memeUrl}', '${text}')">Compartir</button>
                            <button class="btn" onclick="this.parentElement.parentElement.remove()">Cerrar</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(memePreview);
                
            } catch (error) {
                console.error('Error creando meme:', error);
                alert('Error al crear el meme. Intenta de nuevo.');
            }
        }

        function downloadMeme(dataUrl) {
            const link = document.createElement('a');
            link.download = 'simpson-meme.jpg';
            link.href = dataUrl;
            link.click();
        }

        async function shareMeme(dataUrl, text) {
            try {
                // Convertir dataUrl a Blob
                const response = await fetch(dataUrl);
                const blob = await response.blob();
                
                // Compartir usando Web Share API
                if (navigator.share) {
                    const file = new File([blob], 'simpson-meme.jpg', { type: 'image/jpeg' });
                    await navigator.share({
                        title: 'Mi meme de Los Simpson',
                        text: text,
                        files: [file]
                    });
                } else {
                    // Fallback para navegadores que no soportan Web Share API
                    downloadMeme(dataUrl);
                }
            } catch (error) {
                console.error('Error compartiendo:', error);
                alert('Error al compartir. Intenta descargando la imagen.');
            }
        }
    </script>

</body>
</html>
